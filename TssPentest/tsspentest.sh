#!/bin/bash

function ctrl_c(){
	echo -e "\n\n[!] Saliendo...\n"
	exit 1
}

# Ctrl+C
trap ctrl_c INT

# Limpiamos la pantalla
tput clear

whoami
echo -e "\033[31;1m-----------------------------------------------------------------------"
echo "|  _______               ______               __                __    |
| |_     _|.-----.-----.|   __ \.-----.-----.|  |_.-----.-----.|  |_  |
|   |   |  |__ --|__ --||    __/|  -__|     ||   _|  -__|__ --||   _| |
|   |___|  |_____|_____||___|   |_____|__|__||____|_____|_____||____| |"
echo "-----------------------------------------------------------------------"
tput setaf 3
echo "[info] Script multiusos para pentest"
tput sgr0
echo -e "\033[31;1m  ||   Script programado por S3RGI09 (Sergio Casero Veridal)"
tput setaf 14
echo "*      Esta herramienta es una version más completa de TssRecon \033[0m"
echo "*      Script con licencia GNU GPL | El script utiliza Scan.py"
echo "*      IG: s3rgi09__ | GitHub: S3RGI09"
tput setaf 10
echo -n "[+]    Introduce el objetivo (ejemplo: objetivo.com): " && read -r obj
tput sgr0
cd
cd pentest
mkdir $obj
cd $obj	
function inicio(){

	tput clear
	# Movemos el cursos a la posición 3,15 en la pantalla (arriba, izquierda = 0,0)
	tput cup 10 18
 
	# Damos color a las letras
	tput setaf 3
	echo "TSSPENTEST"
	tput sgr0

	# Movemos el cursor de posición
	tput cup 15 17

	# Coloca la pantalla en modo de vídeo inverso 
	tput rev
	echo "MENU PRINCIPAL"
	tput sgr0

	# Movemos el cursor de posición
	tput cup 17 15
	echo "1. Análisis completo"

	# Movemos el cursor de posición
        tput cup 18 15
        echo "2. Análisis de vulnerabilidades"


	# Movemos el cursor de posición
	tput cup 19 15
	echo "3. Busqueda de Exploits"
 
	# Movemos el cursor de posición
	tput cup 20 15
	echo "4. Ataques"

	# Movemos el cursor de posición
	tput cup 21 15
	echo "5. Auditoría wifi"

	# Movemos el cursor de posicion
	tput cup 22 15
	echo "6. Escaneo de puertos"

    echo ""
	# Movemos el cursor de posición
        tput cup 23 15
        echo "Cualquier otro caracter para salir"

	# Coloca la pantalla en modo de realce 
	tput bold
	# Movemos el cursor de posición
	tput cup 25 15
	#read -p "Introduce tu eleccion [1-5] " choice
	echo "Introduce tu eleccion [1-5]"
	read eleccion
	case $eleccion in
		1) 
			recoleccion
		;;
		2)
			vulns
		;;
		3)
			exploits
		;;
		4)
			ataques
		;;
		5)
			wifi
		;;
                6)
                        Puertos
                ;;
	esac

	tput clear
	tput sgr0 

	# Coloca el cursor en la posición marcada por el último sc
	tput rc
}

function recoleccion(){

 
	tput clear
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Comienza el spidering de Wget de "$obj
	echo "Debes repasar todas las posibles paginas especiales (que puedan ser vulnerables o inyectables) en el directorio donde estás ejecutando este script, en la carpeta "$obj
	tput sgr0
	echo "--------------"
	echo "--------------"
	wget -r -l4 –spider -R html -D $obj http://$obj
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Comienza la recoleecion del objetivo"
	tput sgr0
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Informacion de la ip, dns, servidor de correo y transferencia de zona y posibilidad de dns cache snooping."
	tput sgr0
	echo "--------------"
	dnsenum $obj -o infodns
	dnsrecon -d $obj -t axfr > infodns2
	cat infodns
	cat infodns2
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Informacion de la estructura de la pagina"
	tput sgr0
	echo "--------------"
	whatweb -v $obj --log-verbose=Arquitectura_web
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Posibles correos electronicos de la organizacion"
	tput sgr0
	echo "--------------"
	theHarvester -d $obj -l 500 -b google -f correos
	theHarvester -d $obj -l 500 -b bing -f correos2
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Busqueda de posible WAF (Web Aplication Firewall)"
	tput sgr0
	echo "--------------"

	wafw00f -v -a $obj > waf
	cat waf
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Busqueda de directorios ocultos"
	echo "Teclas calientes: 'n' avanza al siguiente directorio y 'q' para el escaneo
"
	tput sgr0
	echo "--------------"
	dirb http://$obj/ -o Directorios_ocultos
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"
	tput setaf 2
	echo "Comienza el escaneo"
	tput sgr0
	echo "--------------"
	nmap -sT -n -Pn -T4 $obj 
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	echo "--------------"
	echo "--------------"
	echo "--------------"		
	tput setaf 2
	echo "--------------"           
	PS3="Selecciona CMS  "

	select pentest in wordpress joomla ninguno 
	do
        	case $pentest in
                	wordpress)
                        	echo "--------------"
	                        echo "Comienza el escaneo para wordpress"
	                        echo "--------------"
				wpscan --update
	                        wpscan --url $obj --enumerate u
        	                read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
				vulns 
				;;
                	joomla) 
                        	echo "--------------"           
	                        echo "Comienza el escaneo para joomla."
        	                echo "--------------"
				joomscan update
				joomscan -u $obj -oh joomscan		
				read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
				vulns
                        	;;
	                ninguno)
        	                echo "--------------"           
                	        echo "Seguir."
                        	echo "--------------"
				vulns
        	                ;;
                	*)
                        	echo "Error: Por favor (selecciona 1..3)!"
	                        ;;
        	esac
	done

	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	vulns
}
	


function exploits(){
	tput clear
	echo "Selecciona la version exacta del protocolo/servicio que buscas. Ejemplo: samba 3.2.20 "
	read exploit
	searchsploit $exploit
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	inicio
}

function ataques(){
	tput clear
	 # Movemos el cursor de posición
        tput cup 15 17
        # Coloca la pantalla en modo de vídeo inverso 
        tput rev
        echo "MENU PRINCIPAL"
        tput sgr0

        # Movemos el cursor de posición
        tput cup 17 15
        echo "1. Manual (metasploit)"
	# Movemos el cursor de posición
        tput cup 19 15
        echo "2. Inyeccion SQL "
	tput cup 21 15
	echo "3. Ataque por contraseñas"
	tput cup 23 15
        echo "4. Inicio"

	 # Coloca la pantalla en modo de realce 
        tput bold
        # Movemos el cursor de posición
        tput cup 25 15
        #read -p "Introduce tu eleccion [1-4] " choice
        echo "Introduce tu eleccion [1-4]"
        read eleccion2
        case $eleccion2 in
                1) 
                       metasploit
                ;;
                2)
                        Inyeccion
                ;;
                3)
			contrasenas
		;;
		4)
                        inicio
                ;;
        
		 *)
                        echo "Error: Por favor (selecciona 1..4)!"
                 ;;

	esac

        tput clear
        tput sgr0 

        # Coloca el cursor en la posición marcada por el último sc
        tput rc
}

function wifi(){
	sudo airgeddon
	
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	inicio
}

function Puertos(){
	cd /home/sergio/scripts
    ./scan.py
        
    read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
    inicio
}

function metasploit(){
	echo "Activando base de datos postgresql...espere por favor"
	echo "Para salir de metasploit, hágalo con el comando quit"
	service postgresql restart
	msfconsole
	
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	inicio
}
#falta la funcion de inyeccion
function vulns(){
	tput clear
         # Movemos el cursor de posición
        tput cup 15 17
        # Coloca la pantalla en modo de vídeo inverso 
        tput rev

	echo "Menu Escaneo de vulns"
        tput sgr0

        # Movemos el cursor de posición
        tput cup 17 15
        echo "1. Vega"
        # Movemos el cursor de posición
        tput cup 19 15
        echo "2. Nesus"
        tput cup 21 15
        echo "3. Nikto"
	tput cup 23 15
        echo "4. Menu principal"
         # Coloca la pantalla en modo de realce 
        tput bold
        # Movemos el cursor de posición
        tput cup 25 15
        #read -p "Introduce tu eleccion [1-4] " choice
        echo "Introduce tu eleccion [1-4]"
        read eleccion3
        case $eleccion3 in
                1) 
			vega
			read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
		        vulns
			;;
                2)
			sudo service nessusd start
			chromium https://localhost:8834
			echo "Cuando acabe, escriba este comando $ sudo service nessud stop"
        		read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	        	vulns
			;;
	        3)
                        nikto -h http://$obj -o nikto.txt
			read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
        	        vulns
			;;
		4)
                        inicio
	                ;;

		 *)
                        echo "Error: Por favor (selecciona 1..4)!"
                        ;;
      esac

        tput clear
        tput sgr0 

        # Coloca el cursor en la posición marcada por el último sc
        tput rc
}

	
function contrasenas(){

	tput clear
        echo "--------------"
        echo "--------------"
        echo "--------------"

        echo "Introduce la direccion exacta"
	read direccion
	echo "Introduce el Módulo (ssh,ftp...; para el protocolo vnc se recomienda el auxiliar de vnc_login en metasploit)"
	read modulo
	echo "Introduce el usuario (sin usuario, este ataque no tiene sentido, por el tiempo que podría tardar)"
	read usuario
	echo "Introduce el diccionario (debe estar en la carpeta root. Por ejemplo password.txt. No introduzcas rutas.)"
	read diccionario
	
	medusa -h $direccion -u $usuario -P /root/$diccionario -M $modulo -F
	read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
	inicio
}
function Inyeccion(){
	tput clear
	tput cup 15 17
        # Coloca la pantalla en modo de vídeo inverso 
        tput rev

	echo "Escoge modo:"
        tput sgr0

        # Movemos el cursor de posición
        tput cup 17 15
        echo "1. GET"
        # Movemos el cursor de posición
        tput cup 19 15
        echo "2. POST"
        tput cup 21 15
        echo "3. Menu Principal"
         # Coloca la pantalla en modo de realce 
        tput bold
        # Movemos el cursor de posición
        tput cup 23 15
        #read -p "Introduce tu eleccion [1-3] " choice
        echo "Introduce tu eleccion [1-3]"

        read modosql
	case $modosql in
                1) 
			echo "introduce la direccion exacta."
			read direccionsql
                        sqlmap -u "$direccionsql" --dump --level=5 --risk=3
                        read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
			Inyeccion
                        ;;
                2)
			echo "Introduce la direccion exacta."
			read direccionsqlpost
			echo "Introduce el POST (puedes sacarlo con live http-headers)"
			read postsql
			sqlmap -u "$direccionsqlpost" --data="$postsql" --dump --level=5 --risk=3
                        read -rsp $'Pulsa cualquier tecla para continuar\n' -n1 key
			Inyeccion
                        ;;
                3)
                        inicio
                        ;;

                 *)
                        echo "Error: Por favor (selecciona 1..3)!"
                        ;;
      esac

        tput clear
        tput sgr0 

}
inicio
cd
cd scripts
